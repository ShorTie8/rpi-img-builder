# raspberry pi 4b

armv7_ccpatch () {
    echo
    echo Applying cc packaging patch.
    patch -p1 < ../${CC}/rpi4b-v7-packaging.patch
    userpatches
    cp -f ../${PAT}/headers-byteshift.patch headers-byteshift.patch
    sed -i 's/export INITRD=$want_initrd/export INITRD=No/g' scripts/package/builddeb
    sed -i 's/export INITRD=$(if_enabled_echo CONFIG_BLK_DEV_INITRD Yes No)/export INITRD=No/g' scripts/package/builddeb
    echo Done.
    echo
}

armv7_ncpatch () {
    echo
    echo Applying nc packaging patch.
    patch -p1 < ../${NC}/rpi4b-v7-packaging.patch
    userpatches
    sed -i 's/export INITRD=$want_initrd/export INITRD=No/g' scripts/package/builddeb
    sed -i 's/export INITRD=$(if_enabled_echo CONFIG_BLK_DEV_INITRD Yes No)/export INITRD=No/g' scripts/package/builddeb
    echo Done.
    echo
}

armv7_fconfig () {
    echo Making bcm2711 defconfig.
    make ARCH=arm bcm2711_defconfig &> /dev/null
    echo Done.
}

armv8_ccpatch () {
    echo
    echo Applying cc packaging patch.
    patch -p1 < ../${CC}/rpi4b-packaging.patch
    userpatches
    cp -f ../${PAT}/headers-byteshift.patch headers-byteshift.patch
    sed -i 's/export INITRD=$want_initrd/export INITRD=No/g' scripts/package/builddeb
    sed -i 's/export INITRD=$(if_enabled_echo CONFIG_BLK_DEV_INITRD Yes No)/export INITRD=No/g' scripts/package/builddeb
    echo Done.
    echo
}

armv8_ncpatch () {
    echo
    echo Applying nc packaging patch.
    patch -p1 < ../${NC}/rpi4b-packaging.patch
    userpatches
    sed -i 's/export INITRD=$want_initrd/export INITRD=No/g' scripts/package/builddeb
    sed -i 's/export INITRD=$(if_enabled_echo CONFIG_BLK_DEV_INITRD Yes No)/export INITRD=No/g' scripts/package/builddeb
    echo Done.
    echo
}

armv8_fconfig () {
    echo Making bcm2711 defconfig.
    make ARCH=arm64 bcm2711_defconfig &> /dev/null
    echo Done.
}

rpi4_clean (){
if ls ${KERNEL}-${VERSION} > /dev/null 2>&1;
	then echo "" && echo -e "${CLN}Cleaning${FIN} ..." && rm -fdr ${KERNEL}-${VERSION};
fi
if ls *.deb > /dev/null 2>&1;
	then mkdir -p debs && mv -f *.deb debs/;
fi
}
